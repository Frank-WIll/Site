import{b as G,u as V,c as j,a as z}from"./GIit8Q6m.js";import{r as w,E as g,aD as Y,d as F,aN as H,aO as q,B as C,H as J,aE as Q,a4 as W,N as B,i as K,w as h,f as N,P as c,O as P,o as X,b as Z,aB as ee}from"./NTENsdai.js";import{S as R,P as _}from"./Cvz8euzd.js";import{u as te}from"./CcRoBTp8.js";function M(){let e=document.activeElement;if(e==null)return null;for(;e!=null&&e.shadowRoot!=null&&e.shadowRoot.activeElement!=null;)e=e.shadowRoot.activeElement;return e}function x(){const e=w(),s=g(()=>{var o,a;return["#text","#comment"].includes((o=e.value)==null?void 0:o.$el.nodeName)?(a=e.value)==null?void 0:a.$el.nextElementSibling:G(e)});return{primitiveElement:e,currentElement:s}}const oe="rovingFocusGroup.onEntryFocus",ne={bubbles:!1,cancelable:!0},ae={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function re(e,s){return s!=="rtl"?e:e==="ArrowLeft"?"ArrowRight":e==="ArrowRight"?"ArrowLeft":e}function se(e,s,o){const a=re(e.key,o);if(!(s==="vertical"&&["ArrowLeft","ArrowRight"].includes(a))&&!(s==="horizontal"&&["ArrowUp","ArrowDown"].includes(a)))return ae[a]}function D(e,s=!1){const o=M();for(const a of e)if(a===o||(a.focus({preventScroll:s}),M()!==o))return}function le(e,s){return e.map((o,a)=>e[(s+a)%e.length])}const O="data-reka-collection-item";function $(e={}){const{key:s="",isProvider:o=!1}=e,a=`${s}CollectionProvider`;let l;if(o){const r=w(new Map);l={collectionRef:w(),itemMap:r},Q(a,l)}else l=Y(a);const y=(r=!1)=>{const n=l.collectionRef.value;if(!n)return[];const i=Array.from(n.querySelectorAll(`[${O}]`)),f=Array.from(l.itemMap.value.values()).sort((m,I)=>i.indexOf(m.ref)-i.indexOf(I.ref));return r?f:f.filter(m=>m.ref.dataset.disabled!=="")},v=F({name:"CollectionSlot",setup(r,{slots:n}){const{primitiveElement:i,currentElement:d}=x();return J(d,()=>{l.collectionRef.value=d.value}),()=>C(R,{ref:i},n)}}),S=F({name:"CollectionItem",inheritAttrs:!1,props:{value:{validator:()=>!0}},setup(r,{slots:n,attrs:i}){const{primitiveElement:d,currentElement:f}=x();return H(m=>{if(f.value){const I=q(f.value);l.itemMap.value.set(I,{ref:f.value,value:r.value}),m(()=>l.itemMap.value.delete(I))}}),()=>C(R,{...i,[O]:"",ref:d},n)}}),b=g(()=>Array.from(l.itemMap.value.values())),t=g(()=>l.itemMap.value.size);return{getItems:y,reactiveItems:b,itemMapSize:t,CollectionSlot:v,CollectionItem:S}}const[ie,ue]=j("RovingFocusGroup"),pe=F({__name:"RovingFocusGroup",props:{orientation:{default:void 0},dir:{},loop:{type:Boolean,default:!1},currentTabStopId:{},defaultCurrentTabStopId:{},preventScrollOnEntryFocus:{type:Boolean,default:!1},asChild:{type:Boolean},as:{}},emits:["entryFocus","update:currentTabStopId"],setup(e,{expose:s,emit:o}){const a=e,l=o,{loop:y,orientation:v,dir:S}=W(a),b=te(S),t=V(a,"currentTabStopId",l,{defaultValue:a.defaultCurrentTabStopId,passive:a.currentTabStopId===void 0}),r=w(!1),n=w(!1),i=w(0),{getItems:d,CollectionSlot:f}=$({isProvider:!0});function m(u){const E=!n.value;if(u.currentTarget&&u.target===u.currentTarget&&E&&!r.value){const T=new CustomEvent(oe,ne);if(u.currentTarget.dispatchEvent(T),l("entryFocus",T),!T.defaultPrevented){const A=d().map(p=>p.ref).filter(p=>p.dataset.disabled!==""),k=A.find(p=>p.getAttribute("data-active")==="true"),U=A.find(p=>p.id===t.value),L=[k,U,...A].filter(Boolean);D(L,a.preventScrollOnEntryFocus)}}n.value=!1}function I(){setTimeout(()=>{n.value=!1},1)}return s({getItems:d}),ue({loop:y,dir:b,orientation:v,currentTabStopId:t,onItemFocus:u=>{t.value=u},onItemShiftTab:()=>{r.value=!0},onFocusableItemAdd:()=>{i.value++},onFocusableItemRemove:()=>{i.value--}}),(u,E)=>(K(),B(c(f),null,{default:h(()=>[N(c(_),{tabindex:r.value||i.value===0?-1:0,"data-orientation":c(v),as:u.as,"as-child":u.asChild,dir:c(b),style:{outline:"none"},onMousedown:E[0]||(E[0]=T=>n.value=!0),onMouseup:I,onFocus:m,onBlur:E[1]||(E[1]=T=>r.value=!1)},{default:h(()=>[P(u.$slots,"default")]),_:3},8,["tabindex","data-orientation","as","as-child","dir"])]),_:3}))}}),ve=F({__name:"RovingFocusItem",props:{tabStopId:{},focusable:{type:Boolean,default:!0},active:{type:Boolean,default:!0},allowShiftKey:{type:Boolean},asChild:{type:Boolean},as:{default:"span"}},setup(e){const s=e,o=ie(),a=z(),l=g(()=>s.tabStopId||a),y=g(()=>o.currentTabStopId.value===l.value),{getItems:v,CollectionItem:S}=$();X(()=>{s.focusable&&o.onFocusableItemAdd()}),Z(()=>{s.focusable&&o.onFocusableItemRemove()});function b(t){if(t.key==="Tab"&&t.shiftKey){o.onItemShiftTab();return}if(t.target!==t.currentTarget)return;const r=se(t,o.orientation.value,o.dir.value);if(r!==void 0){if(t.metaKey||t.ctrlKey||t.altKey||!s.allowShiftKey&&t.shiftKey)return;t.preventDefault();let n=[...v().map(i=>i.ref).filter(i=>i.dataset.disabled!=="")];if(r==="last")n.reverse();else if(r==="prev"||r==="next"){r==="prev"&&n.reverse();const i=n.indexOf(t.currentTarget);n=o.loop.value?le(n,i+1):n.slice(i+1)}ee(()=>D(n))}}return(t,r)=>(K(),B(c(S),null,{default:h(()=>[N(c(_),{tabindex:y.value?0:-1,"data-orientation":c(o).orientation.value,"data-active":t.active,"data-disabled":t.focusable?void 0:"",as:t.as,"as-child":t.asChild,onMousedown:r[0]||(r[0]=n=>{t.focusable?c(o).onItemFocus(l.value):n.preventDefault()}),onFocus:r[1]||(r[1]=n=>c(o).onItemFocus(l.value)),onKeydown:b},{default:h(()=>[P(t.$slots,"default")]),_:3},8,["tabindex","data-orientation","data-active","data-disabled","as","as-child"])]),_:3}))}});export{ae as M,pe as _,ve as a,M as g,$ as u};
